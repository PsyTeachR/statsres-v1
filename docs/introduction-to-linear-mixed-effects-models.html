<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 6 Introduction to Linear Mixed Effects Models | Statistics and Research Design</title>
<meta name="author" content="James Bartlett">
<meta name="description" content="In this chapter, we will explore linear mixed effects models by simulating data. Experimental designs that sample both subjects and stimuli from a larger population need to account for random...">
<meta name="generator" content="bookdown 0.37 with bs4_book()">
<meta property="og:title" content="Chapter 6 Introduction to Linear Mixed Effects Models | Statistics and Research Design">
<meta property="og:type" content="book">
<meta property="og:url" content="https://psyteachr.github.io/statsresdesign/introduction-to-linear-mixed-effects-models.html">
<meta property="og:image" content="https://psyteachr.github.io/statsresdesign/images/logos/logo.png">
<meta property="og:description" content="In this chapter, we will explore linear mixed effects models by simulating data. Experimental designs that sample both subjects and stimuli from a larger population need to account for random...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 6 Introduction to Linear Mixed Effects Models | Statistics and Research Design">
<meta name="twitter:description" content="In this chapter, we will explore linear mixed effects models by simulating data. Experimental designs that sample both subjects and stimuli from a larger population need to account for random...">
<meta name="twitter:image" content="https://psyteachr.github.io/statsresdesign/images/logos/logo.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.6.1/transition.js"></script><script src="libs/bs3compat-0.6.1/tabs.js"></script><script src="libs/bs3compat-0.6.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-6NP3MF25W3"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-6NP3MF25W3');
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
<link rel="stylesheet" href="include/psyteachr.css">
<link rel="stylesheet" href="include/webex.css">
<link rel="stylesheet" href="include/style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Statistics and Research Design</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Overview</a></li>
<li><a class="" href="introduction-to-linear-regression.html"><span class="header-section-number">1</span> Introduction to Linear Regression</a></li>
<li><a class="" href="multiple-linear-regression.html"><span class="header-section-number">2</span> Multiple Linear Regression</a></li>
<li><a class="" href="introduction-to-generalised-linear-models.html"><span class="header-section-number">3</span> Introduction to Generalised Linear Models</a></li>
<li><a class="" href="introduction-to-bayesian-hypothesis-testing.html"><span class="header-section-number">4</span> Introduction to Bayesian Hypothesis Testing</a></li>
<li><a class="" href="introduction-to-bayesian-estimation.html"><span class="header-section-number">5</span> Introduction to Bayesian Estimation</a></li>
<li><a class="active" href="introduction-to-linear-mixed-effects-models.html"><span class="header-section-number">6</span> Introduction to Linear Mixed Effects Models</a></li>
<li class="book-part">Appendices</li>
<li><a class="" href="installing-r.html"><span class="header-section-number">A</span> Installing R</a></li>
<li><a class="" href="conventions.html"><span class="header-section-number">B</span> Conventions</a></li>
<li><a class="" href="license.html">License</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/psyteachr/statsresdesign">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="introduction-to-linear-mixed-effects-models" class="section level1" number="6">
<h1>
<span class="header-section-number">6</span> Introduction to Linear Mixed Effects Models<a class="anchor" aria-label="anchor" href="#introduction-to-linear-mixed-effects-models"><i class="fas fa-link"></i></a>
</h1>
<p>In this chapter, we will explore linear mixed effects models by simulating data. Experimental designs that sample both subjects and stimuli from a larger population need to account for random effects of both subjects and stimuli using mixed-effects models. However, much of this research is analyzed using analysis of variance on aggregated responses because researchers are not confident specifying and interpreting mixed-effects models. This chapter will explain how to simulate data with random-effects structure (using the faux R package) and analyze the data using linear mixed-effects regression (with the lme4 R package), with a focus on interpreting the output in light of the simulated parameters. You will also learn to calculate power using simulation.</p>
<div id="learning-objectives-5" class="section level2" number="6.1">
<h2>
<span class="header-section-number">6.1</span> Learning objectives<a class="anchor" aria-label="anchor" href="#learning-objectives-5"><i class="fas fa-link"></i></a>
</h2>
<p>By the end of this chapter, you should be able to:</p>
<ol style="list-style-type: decimal">
<li><p>Understand how data are structured for a linear mixed effects model</p></li>
<li><p>Be able to simulate data with a cross-classified structure</p></li>
<li><p>Understand how to run and interpret a linear mixed effects model</p></li>
<li><p>Run a power calculation for LMEM</p></li>
</ol>
<p>To follow along to this chapter and try the code yourself, please download the Rmd file we will be using in <a href="data/11_data.zip">this zip file</a>.</p>
</div>
<div id="packages-and-the-data-sets-2" class="section level2" number="6.2">
<h2>
<span class="header-section-number">6.2</span> Packages and the data sets<a class="anchor" aria-label="anchor" href="#packages-and-the-data-sets-2"><i class="fas fa-link"></i></a>
</h2>
<p>We will simulate data using the faux package.</p>
<div class="sourceCode" id="cb303"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>   <span class="co"># for data wrangling, pipes, and good dataviz</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://afex.singmann.science/">afex</a></span><span class="op">)</span>        <span class="co"># for mixed effect models</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/bbolker/broom.mixed">broom.mixed</a></span><span class="op">)</span> <span class="co"># for getting tidy data tables from mixed models</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/debruine/faux">faux</a></span><span class="op">)</span>        <span class="co"># for simulating correlated variables</span></span></code></pre></div>
</div>
<div id="simulation" class="section level2" number="6.3">
<h2>
<span class="header-section-number">6.3</span> Simulation<a class="anchor" aria-label="anchor" href="#simulation"><i class="fas fa-link"></i></a>
</h2>
<p>First, we need to generate some data with the right structure for a mixed effects analysis. Here, we will simulate data for a Stroop task where subjects (<code>sub</code>) say the colour of colour words (<code>stim</code>) shown in each of two versions (<code>congruent</code> and <code>incongruent</code>). Subjects are in one of two conditions (<code>hard</code> or <code>easy</code>). The dependent variable is reaction time (`rt``).</p>
<p>We expect people to have faster reaction times for congruent stimuli than incongruent stimuli (main effect of version) and to be faster in the easy condition than the hard condition (main effect of condition). We'll look at some different interaction patterns below.</p>
<div id="random-factors" class="section level3" number="6.3.1">
<h3>
<span class="header-section-number">6.3.1</span> Random Factors<a class="anchor" aria-label="anchor" href="#random-factors"><i class="fas fa-link"></i></a>
</h3>
<p>First, set up the overall structure of your data by specifying the number of observations for each random factor. Here, we have a crossed design, so each subject responds to each stimulus. We'll set the numbers to small numbers as a demo first.</p>
<div class="sourceCode" id="cb304"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sub_n</span>  <span class="op">&lt;-</span> <span class="fl">2</span> <span class="co"># number of subjects in this simulation</span></span>
<span><span class="va">stim_n</span>  <span class="op">&lt;-</span> <span class="fl">2</span> <span class="co"># number of stimuli in this simulation</span></span>
<span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_random.html">add_random</a></span><span class="op">(</span>sub <span class="op">=</span> <span class="va">sub_n</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_random.html">add_random</a></span><span class="op">(</span>stim <span class="op">=</span> <span class="va">stim_n</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dat</span></span></code></pre></div>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="left">sub</th>
<th align="left">stim</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">sub1</td>
<td align="left">stim1</td>
</tr>
<tr class="even">
<td align="left">sub1</td>
<td align="left">stim2</td>
</tr>
<tr class="odd">
<td align="left">sub2</td>
<td align="left">stim1</td>
</tr>
<tr class="even">
<td align="left">sub2</td>
<td align="left">stim2</td>
</tr>
</tbody>
</table></div>
</div>
</div>
<div id="fixed-factors" class="section level3" number="6.3.2">
<h3>
<span class="header-section-number">6.3.2</span> Fixed Factors<a class="anchor" aria-label="anchor" href="#fixed-factors"><i class="fas fa-link"></i></a>
</h3>
<p>Next, add the fixed factors. Specify if they vary between one of the random factors and specify the names of the levels.</p>
<p>Each subject is in only one condition, so the code below assigns half <code>easy</code> and half <code>hard</code>. You can change the proportion of subjects assigned each level with the <code>.prob</code> argument.</p>
<p>Stimuli are seen in both <code>congruent</code> and <code>incongruent</code> versions, so this will double the number of rows in our resulting data set.</p>
<div class="sourceCode" id="cb305"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sub_n</span>  <span class="op">&lt;-</span> <span class="fl">2</span> <span class="co"># number of subjects in this simulation</span></span>
<span><span class="va">stim_n</span>  <span class="op">&lt;-</span> <span class="fl">2</span> <span class="co"># number of stimuli in this simulation</span></span>
<span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_random.html">add_random</a></span><span class="op">(</span>sub <span class="op">=</span> <span class="va">sub_n</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_random.html">add_random</a></span><span class="op">(</span>stim <span class="op">=</span> <span class="va">stim_n</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_between.html">add_between</a></span><span class="op">(</span>.by <span class="op">=</span> <span class="st">"sub"</span>, condition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"easy"</span>,<span class="st">"hard"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_within.html">add_within</a></span><span class="op">(</span>version <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"congruent"</span>, <span class="st">"incongruent"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dat</span></span></code></pre></div>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="left">sub</th>
<th align="left">stim</th>
<th align="left">condition</th>
<th align="left">version</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">sub1</td>
<td align="left">stim1</td>
<td align="left">easy</td>
<td align="left">congruent</td>
</tr>
<tr class="even">
<td align="left">sub1</td>
<td align="left">stim1</td>
<td align="left">easy</td>
<td align="left">incongruent</td>
</tr>
<tr class="odd">
<td align="left">sub1</td>
<td align="left">stim2</td>
<td align="left">easy</td>
<td align="left">congruent</td>
</tr>
<tr class="even">
<td align="left">sub1</td>
<td align="left">stim2</td>
<td align="left">easy</td>
<td align="left">incongruent</td>
</tr>
<tr class="odd">
<td align="left">sub2</td>
<td align="left">stim1</td>
<td align="left">hard</td>
<td align="left">congruent</td>
</tr>
<tr class="even">
<td align="left">sub2</td>
<td align="left">stim1</td>
<td align="left">hard</td>
<td align="left">incongruent</td>
</tr>
<tr class="odd">
<td align="left">sub2</td>
<td align="left">stim2</td>
<td align="left">hard</td>
<td align="left">congruent</td>
</tr>
<tr class="even">
<td align="left">sub2</td>
<td align="left">stim2</td>
<td align="left">hard</td>
<td align="left">incongruent</td>
</tr>
</tbody>
</table></div>
</div>
</div>
<div id="contrast-coding" class="section level3" number="6.3.3">
<h3>
<span class="header-section-number">6.3.3</span> Contrast Coding<a class="anchor" aria-label="anchor" href="#contrast-coding"><i class="fas fa-link"></i></a>
</h3>
<p>To be able to calculate the dependent variable, you need to recode categorical variables into numbers. Use the helper function <code><a href="https://rdrr.io/pkg/faux/man/add_contrast.html">add_contrast()</a></code> for this. The code below creates anova-coded versions of <code>condition</code> and <code>version</code>. Luckily for us, the factor levels default to a sensible order, with "easy" predicted to have a faster (lower) reactive time than "hard", and "congruent" predicted to have a faster RT than "incongruent", but we can also customise the order of levels with <code><a href="https://rdrr.io/pkg/faux/man/add_contrast.html">add_contrast()</a></code>; see the <a href="https://debruine.github.io/faux/articles/contrasts.html">contrasts vignette</a> for more details.</p>
<div class="sourceCode" id="cb306"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sub_n</span>  <span class="op">&lt;-</span> <span class="fl">2</span> <span class="co"># number of subjects in this simulation</span></span>
<span><span class="va">stim_n</span>  <span class="op">&lt;-</span> <span class="fl">2</span> <span class="co"># number of stimuli in this simulation</span></span>
<span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_random.html">add_random</a></span><span class="op">(</span>sub <span class="op">=</span> <span class="va">sub_n</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_random.html">add_random</a></span><span class="op">(</span>stim <span class="op">=</span> <span class="va">stim_n</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_between.html">add_between</a></span><span class="op">(</span>.by <span class="op">=</span> <span class="st">"sub"</span>, condition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"easy"</span>,<span class="st">"hard"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_within.html">add_within</a></span><span class="op">(</span>version <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"congruent"</span>, <span class="st">"incongruent"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_contrast.html">add_contrast</a></span><span class="op">(</span><span class="st">"condition"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_contrast.html">add_contrast</a></span><span class="op">(</span><span class="st">"version"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dat</span></span></code></pre></div>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<colgroup>
<col width="6%">
<col width="7%">
<col width="12%">
<col width="14%">
<col width="24%">
<col width="36%">
</colgroup>
<thead><tr class="header">
<th align="left">sub</th>
<th align="left">stim</th>
<th align="left">condition</th>
<th align="left">version</th>
<th align="right">condition.hard-easy</th>
<th align="right">version.incongruent-congruent</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">sub1</td>
<td align="left">stim1</td>
<td align="left">easy</td>
<td align="left">congruent</td>
<td align="right">-0.5</td>
<td align="right">-0.5</td>
</tr>
<tr class="even">
<td align="left">sub1</td>
<td align="left">stim1</td>
<td align="left">easy</td>
<td align="left">incongruent</td>
<td align="right">-0.5</td>
<td align="right">0.5</td>
</tr>
<tr class="odd">
<td align="left">sub1</td>
<td align="left">stim2</td>
<td align="left">easy</td>
<td align="left">congruent</td>
<td align="right">-0.5</td>
<td align="right">-0.5</td>
</tr>
<tr class="even">
<td align="left">sub1</td>
<td align="left">stim2</td>
<td align="left">easy</td>
<td align="left">incongruent</td>
<td align="right">-0.5</td>
<td align="right">0.5</td>
</tr>
<tr class="odd">
<td align="left">sub2</td>
<td align="left">stim1</td>
<td align="left">hard</td>
<td align="left">congruent</td>
<td align="right">0.5</td>
<td align="right">-0.5</td>
</tr>
<tr class="even">
<td align="left">sub2</td>
<td align="left">stim1</td>
<td align="left">hard</td>
<td align="left">incongruent</td>
<td align="right">0.5</td>
<td align="right">0.5</td>
</tr>
<tr class="odd">
<td align="left">sub2</td>
<td align="left">stim2</td>
<td align="left">hard</td>
<td align="left">congruent</td>
<td align="right">0.5</td>
<td align="right">-0.5</td>
</tr>
<tr class="even">
<td align="left">sub2</td>
<td align="left">stim2</td>
<td align="left">hard</td>
<td align="left">incongruent</td>
<td align="right">0.5</td>
<td align="right">0.5</td>
</tr>
</tbody>
</table></div>
</div>
<p>The function defaults to very descriptive names that help you interpret the fixed factors. Here, "condition.hard-easy" means the main effect of this factor is interpreted as the RT for hard trials minus the RT for easy trials, and "version.incongruent-congruent" means the main effect of this factor is interpreted as the RT for incongruent trials minus the RT for congruent trials. However, we can change these to simpler labels with the <code>colnames</code> argument.</p>
</div>
<div id="random-effects" class="section level3" number="6.3.4">
<h3>
<span class="header-section-number">6.3.4</span> Random Effects<a class="anchor" aria-label="anchor" href="#random-effects"><i class="fas fa-link"></i></a>
</h3>
<p>Now we specify the random effect structure. We'll just add random intercepts to start, but will cover random slopes later.</p>
<p>Each subject will have slightly faster or slower reaction times on average; this is their random intercept (<code>sub_i</code>). We'll model it from a normal distribution with a mean of 0 and SD of 100ms.</p>
<p>Each stimulus will have slightly faster or slower reaction times on average; this is their random intercept (<code>stim_i</code>). We'll model it from a normal distribution with a mean of 0 and SD of 50ms (it seems reasonable to expect less variability between words than people for this task).</p>
<p>Run this code a few times to see how the random effects change each time. this is because they are <strong>sampled</strong> from populations.</p>
<div class="sourceCode" id="cb307"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sub_n</span>  <span class="op">&lt;-</span> <span class="fl">2</span> <span class="co"># number of subjects in this simulation</span></span>
<span><span class="va">stim_n</span>  <span class="op">&lt;-</span> <span class="fl">2</span> <span class="co"># number of stimuli in this simulation</span></span>
<span><span class="va">sub_sd</span> <span class="op">&lt;-</span> <span class="fl">100</span> <span class="co"># SD for the subjects' random intercept</span></span>
<span><span class="va">stim_sd</span> <span class="op">&lt;-</span> <span class="fl">50</span> <span class="co"># SD for the stimuli's random intercept</span></span>
<span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_random.html">add_random</a></span><span class="op">(</span>sub <span class="op">=</span> <span class="va">sub_n</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_random.html">add_random</a></span><span class="op">(</span>stim <span class="op">=</span> <span class="va">stim_n</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_between.html">add_between</a></span><span class="op">(</span>.by <span class="op">=</span> <span class="st">"sub"</span>, condition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"easy"</span>,<span class="st">"hard"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_within.html">add_within</a></span><span class="op">(</span>version <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"congruent"</span>, <span class="st">"incongruent"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_contrast.html">add_contrast</a></span><span class="op">(</span><span class="st">"condition"</span>, colnames <span class="op">=</span> <span class="st">"cond"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_contrast.html">add_contrast</a></span><span class="op">(</span><span class="st">"version"</span>, colnames <span class="op">=</span> <span class="st">"vers"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_ranef.html">add_ranef</a></span><span class="op">(</span>.by <span class="op">=</span> <span class="st">"sub"</span>, sub_i <span class="op">=</span> <span class="va">sub_sd</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_ranef.html">add_ranef</a></span><span class="op">(</span>.by <span class="op">=</span> <span class="st">"stim"</span>, stim_i <span class="op">=</span> <span class="va">stim_sd</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dat</span></span></code></pre></div>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="left">sub</th>
<th align="left">stim</th>
<th align="left">condition</th>
<th align="left">version</th>
<th align="right">cond</th>
<th align="right">vers</th>
<th align="right">sub_i</th>
<th align="right">stim_i</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">sub1</td>
<td align="left">stim1</td>
<td align="left">easy</td>
<td align="left">congruent</td>
<td align="right">-0.5</td>
<td align="right">-0.5</td>
<td align="right">-18.53489</td>
<td align="right">-9.599131</td>
</tr>
<tr class="even">
<td align="left">sub1</td>
<td align="left">stim1</td>
<td align="left">easy</td>
<td align="left">incongruent</td>
<td align="right">-0.5</td>
<td align="right">0.5</td>
<td align="right">-18.53489</td>
<td align="right">-9.599131</td>
</tr>
<tr class="odd">
<td align="left">sub1</td>
<td align="left">stim2</td>
<td align="left">easy</td>
<td align="left">congruent</td>
<td align="right">-0.5</td>
<td align="right">-0.5</td>
<td align="right">-18.53489</td>
<td align="right">22.863534</td>
</tr>
<tr class="even">
<td align="left">sub1</td>
<td align="left">stim2</td>
<td align="left">easy</td>
<td align="left">incongruent</td>
<td align="right">-0.5</td>
<td align="right">0.5</td>
<td align="right">-18.53489</td>
<td align="right">22.863534</td>
</tr>
<tr class="odd">
<td align="left">sub2</td>
<td align="left">stim1</td>
<td align="left">hard</td>
<td align="left">congruent</td>
<td align="right">0.5</td>
<td align="right">-0.5</td>
<td align="right">-66.10681</td>
<td align="right">-9.599131</td>
</tr>
<tr class="even">
<td align="left">sub2</td>
<td align="left">stim1</td>
<td align="left">hard</td>
<td align="left">incongruent</td>
<td align="right">0.5</td>
<td align="right">0.5</td>
<td align="right">-66.10681</td>
<td align="right">-9.599131</td>
</tr>
<tr class="odd">
<td align="left">sub2</td>
<td align="left">stim2</td>
<td align="left">hard</td>
<td align="left">congruent</td>
<td align="right">0.5</td>
<td align="right">-0.5</td>
<td align="right">-66.10681</td>
<td align="right">22.863534</td>
</tr>
<tr class="even">
<td align="left">sub2</td>
<td align="left">stim2</td>
<td align="left">hard</td>
<td align="left">incongruent</td>
<td align="right">0.5</td>
<td align="right">0.5</td>
<td align="right">-66.10681</td>
<td align="right">22.863534</td>
</tr>
</tbody>
</table></div>
</div>
</div>
<div id="error-term" class="section level3" number="6.3.5">
<h3>
<span class="header-section-number">6.3.5</span> Error Term<a class="anchor" aria-label="anchor" href="#error-term"><i class="fas fa-link"></i></a>
</h3>
<p>Finally, add an error term. This uses the same <code><a href="https://rdrr.io/pkg/faux/man/add_ranef.html">add_ranef()</a></code> function, just without specifying which random factor it's for with <code>.by</code>. In essence, this samples an error value from a normal distribution with a mean of 0 and the specified SD for each trial. We'll also increase the number of subjects and stimuli to more realistic values now.</p>
<div class="sourceCode" id="cb308"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sub_n</span>    <span class="op">&lt;-</span> <span class="fl">200</span> <span class="co"># number of subjects in this simulation</span></span>
<span><span class="va">stim_n</span>   <span class="op">&lt;-</span> <span class="fl">50</span>  <span class="co"># number of stimuli in this simulation</span></span>
<span><span class="va">sub_sd</span>   <span class="op">&lt;-</span> <span class="fl">100</span> <span class="co"># SD for the subjects' random intercept</span></span>
<span><span class="va">stim_sd</span>  <span class="op">&lt;-</span> <span class="fl">50</span>  <span class="co"># SD for the stimuli's random intercept</span></span>
<span><span class="va">error_sd</span> <span class="op">&lt;-</span> <span class="fl">25</span>  <span class="co"># residual (error) SD</span></span>
<span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_random.html">add_random</a></span><span class="op">(</span>sub <span class="op">=</span> <span class="va">sub_n</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_random.html">add_random</a></span><span class="op">(</span>stim <span class="op">=</span> <span class="va">stim_n</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_between.html">add_between</a></span><span class="op">(</span>.by <span class="op">=</span> <span class="st">"sub"</span>, condition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"easy"</span>,<span class="st">"hard"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_within.html">add_within</a></span><span class="op">(</span>version <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"congruent"</span>, <span class="st">"incongruent"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_contrast.html">add_contrast</a></span><span class="op">(</span><span class="st">"condition"</span>, colnames <span class="op">=</span> <span class="st">"cond"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_contrast.html">add_contrast</a></span><span class="op">(</span><span class="st">"version"</span>, colnames <span class="op">=</span> <span class="st">"vers"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_ranef.html">add_ranef</a></span><span class="op">(</span>.by <span class="op">=</span> <span class="st">"sub"</span>, sub_i <span class="op">=</span> <span class="va">sub_sd</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_ranef.html">add_ranef</a></span><span class="op">(</span>.by <span class="op">=</span> <span class="st">"stim"</span>, stim_i <span class="op">=</span> <span class="va">stim_sd</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_ranef.html">add_ranef</a></span><span class="op">(</span>err <span class="op">=</span> <span class="va">error_sd</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="calculate-the-dv" class="section level3" number="6.3.6">
<h3>
<span class="header-section-number">6.3.6</span> Calculate the DV<a class="anchor" aria-label="anchor" href="#calculate-the-dv"><i class="fas fa-link"></i></a>
</h3>
<p>Now we can calculate the dependent variable (<code>rt</code>) by adding together an overall intercept (mean reaction time for all trials), the subject-specific intercept, the stimulus-specific intercept, and an error term, plus the effect of subject condition, the effect of stimulus version, and the interaction between condition and version.</p>
<p>We set these effects in raw units (ms). So when we set the effect of subject condition (<code>sub_cond_eff</code>) to 50, that means the average difference between the easy and hard condition is 50ms. <code>Easy</code> was coded as -0.5 and <code>hard</code> was coded as +0.5, which means that trials in the easy condition have -0.5 * 50ms (i.e., -25ms) added to their reaction time, while trials in the hard condition have +0.5 * 50ms (i.e., +25ms) added to their reaction time.</p>
<div class="sourceCode" id="cb309"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sub_n</span>         <span class="op">&lt;-</span> <span class="fl">200</span> <span class="co"># number of subjects in this simulation</span></span>
<span><span class="va">stim_n</span>        <span class="op">&lt;-</span> <span class="fl">50</span>  <span class="co"># number of stimuli in this simulation</span></span>
<span><span class="va">sub_sd</span>        <span class="op">&lt;-</span> <span class="fl">100</span> <span class="co"># SD for the subjects' random intercept</span></span>
<span><span class="va">stim_sd</span>       <span class="op">&lt;-</span> <span class="fl">50</span>  <span class="co"># SD for the stimuli's random intercept</span></span>
<span><span class="va">error_sd</span>      <span class="op">&lt;-</span> <span class="fl">25</span>  <span class="co"># residual (error) SD</span></span>
<span><span class="va">grand_i</span>       <span class="op">&lt;-</span> <span class="fl">400</span> <span class="co"># overall mean rt</span></span>
<span><span class="va">cond_eff</span>      <span class="op">&lt;-</span> <span class="fl">50</span>  <span class="co"># mean difference between conditions: hard - easy</span></span>
<span><span class="va">vers_eff</span>      <span class="op">&lt;-</span> <span class="fl">50</span>  <span class="co"># mean difference between versions: incongruent - congruent</span></span>
<span><span class="va">cond_vers_ixn</span> <span class="op">&lt;-</span>  <span class="fl">0</span>  <span class="co"># interaction between version and condition</span></span>
<span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_random.html">add_random</a></span><span class="op">(</span>sub <span class="op">=</span> <span class="va">sub_n</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_random.html">add_random</a></span><span class="op">(</span>stim <span class="op">=</span> <span class="va">stim_n</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_between.html">add_between</a></span><span class="op">(</span>.by <span class="op">=</span> <span class="st">"sub"</span>, condition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"easy"</span>,<span class="st">"hard"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_within.html">add_within</a></span><span class="op">(</span>version <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"congruent"</span>, <span class="st">"incongruent"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_contrast.html">add_contrast</a></span><span class="op">(</span><span class="st">"condition"</span>, colnames <span class="op">=</span> <span class="st">"cond"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_contrast.html">add_contrast</a></span><span class="op">(</span><span class="st">"version"</span>, colnames <span class="op">=</span> <span class="st">"vers"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_ranef.html">add_ranef</a></span><span class="op">(</span>.by <span class="op">=</span> <span class="st">"sub"</span>, sub_i <span class="op">=</span> <span class="va">sub_sd</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_ranef.html">add_ranef</a></span><span class="op">(</span>.by <span class="op">=</span> <span class="st">"stim"</span>, stim_i <span class="op">=</span> <span class="va">stim_sd</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_ranef.html">add_ranef</a></span><span class="op">(</span>err <span class="op">=</span> <span class="va">error_sd</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>rt <span class="op">=</span> <span class="va">grand_i</span> <span class="op">+</span> <span class="va">sub_i</span> <span class="op">+</span> <span class="va">stim_i</span> <span class="op">+</span> <span class="va">err</span> <span class="op">+</span></span>
<span>         <span class="op">(</span><span class="va">cond</span> <span class="op">*</span> <span class="va">cond_eff</span><span class="op">)</span> <span class="op">+</span> </span>
<span>         <span class="op">(</span><span class="va">vers</span> <span class="op">*</span> <span class="va">vers_eff</span><span class="op">)</span> <span class="op">+</span> </span>
<span>         <span class="op">(</span><span class="va">cond</span> <span class="op">*</span> <span class="va">vers</span> <span class="op">*</span> <span class="va">cond_vers_ixn</span><span class="op">)</span> <span class="co"># in this example, this is always 0 and could be omitted</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>As always, graph to make sure you've simulated the general pattern you expected.</p>
<div class="sourceCode" id="cb310"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">dat</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">condition</span>, <span class="va">rt</span>, color <span class="op">=</span> <span class="va">version</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="va">grand_i</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_violin.html">geom_violin</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_summary.html">stat_summary</a></span><span class="op">(</span>fun <span class="op">=</span> <span class="va">mean</span>,</span>
<span>               fun.min <span class="op">=</span> \<span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">}</span>,</span>
<span>               fun.max <span class="op">=</span> \<span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">}</span>,</span>
<span>               position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html">position_dodge</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_color_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Dark2"</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:plot-rt"></span>
<img src="11-LMEM_files/figure-html/plot-rt-1.png" alt="Double-check the simulated pattern" width="100%"><p class="caption">
Figure 6.1: Double-check the simulated pattern
</p>
</div>
</div>
<div id="interactions" class="section level3" number="6.3.7">
<h3>
<span class="header-section-number">6.3.7</span> Interactions<a class="anchor" aria-label="anchor" href="#interactions"><i class="fas fa-link"></i></a>
</h3>
<p>If you want to simulate an interaction, it can sometimes be tricky to figure out what to set the main effects and interaction effect to. It can often be easier to think about the simple main effects for each cell. Create four new variables and set them to the deviations from the overall mean you'd expect for each condition (so they should add up to 0). Here, we're simulating a small effect of version in the hard condition (50ms difference) and double that effect of version in the easy condition (100ms difference).</p>
<div class="sourceCode" id="cb311"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set variables to use in calculations below</span></span>
<span><span class="va">easy_congr</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">50</span></span>
<span><span class="va">easy_incon</span> <span class="op">&lt;-</span> <span class="op">+</span><span class="fl">50</span></span>
<span><span class="va">hard_congr</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">25</span></span>
<span><span class="va">hard_incon</span> <span class="op">&lt;-</span> <span class="op">+</span><span class="fl">25</span></span></code></pre></div>
<p>Use the code below to transform the simple main effects above into main effects and interactions for use in the equations below. This uses the <code><a href="https://rdrr.io/pkg/faux/man/sim_design.html">sim_design()</a></code> function from faux to set up a fixed-design simulated sample with the exact cell means above (using <code>empirical = TRUE</code>), runs a linear model on the data, and extracts the coefficients. This only works if you contrast-code the factors in the same way, and use the same formula as your LMEM. It doesn't matter if you set the factors to between or within for this, so it's easiest to set them all to between.</p>
<div class="sourceCode" id="cb312"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># simulated the data</span></span>
<span><span class="va">fixed_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/faux/man/sim_design.html">sim_design</a></span><span class="op">(</span></span>
<span>  between <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>condition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"easy"</span>,<span class="st">"hard"</span><span class="op">)</span>,</span>
<span>                 version   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"congruent"</span>, <span class="st">"incongruent"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  mu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">easy_congr</span>, <span class="va">easy_incon</span>, <span class="va">hard_congr</span>, <span class="va">hard_incon</span><span class="op">)</span>,</span>
<span>  dv <span class="op">=</span> <span class="st">"rt"</span>,</span>
<span>  empirical <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  plot <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># add the same contrasts you'll use in your LMEM </span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_contrast.html">add_contrast</a></span><span class="op">(</span><span class="st">"condition"</span>, colnames <span class="op">=</span> <span class="st">"cond"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_contrast.html">add_contrast</a></span><span class="op">(</span><span class="st">"version"</span>, colnames <span class="op">=</span> <span class="st">"vers"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># run the same formula using lm()</span></span>
<span><span class="va">fixed_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">rt</span> <span class="op">~</span> <span class="va">cond</span> <span class="op">*</span> <span class="va">vers</span>, data <span class="op">=</span> <span class="va">fixed_data</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># extract and round the coefficients</span></span>
<span><span class="va">fixed_coefs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">fixed_model</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># assign the coefficients to the relevant variables</span></span>
<span><span class="va">cond_eff</span> <span class="op">&lt;-</span> <span class="va">fixed_coefs</span><span class="op">[</span><span class="st">"cond"</span><span class="op">]</span></span>
<span><span class="va">vers_eff</span> <span class="op">&lt;-</span> <span class="va">fixed_coefs</span><span class="op">[</span><span class="st">"vers"</span><span class="op">]</span></span>
<span><span class="va">cond_vers_ixn</span> <span class="op">&lt;-</span> <span class="va">fixed_coefs</span><span class="op">[</span><span class="st">"cond:vers"</span><span class="op">]</span></span></code></pre></div>
<p>Then generate the rt the same way we did above, but also add the interaction effect multiplied by the effect-coded subject condition and stimulus version.</p>
<div class="sourceCode" id="cb313"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_random.html">add_random</a></span><span class="op">(</span>sub <span class="op">=</span> <span class="va">sub_n</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_random.html">add_random</a></span><span class="op">(</span>stim <span class="op">=</span> <span class="va">stim_n</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_between.html">add_between</a></span><span class="op">(</span>.by <span class="op">=</span> <span class="st">"sub"</span>, condition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"easy"</span>,<span class="st">"hard"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_within.html">add_within</a></span><span class="op">(</span>version <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"congruent"</span>, <span class="st">"incongruent"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_contrast.html">add_contrast</a></span><span class="op">(</span><span class="st">"condition"</span>, colnames <span class="op">=</span> <span class="st">"cond"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_contrast.html">add_contrast</a></span><span class="op">(</span><span class="st">"version"</span>, colnames <span class="op">=</span> <span class="st">"vers"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_ranef.html">add_ranef</a></span><span class="op">(</span>.by <span class="op">=</span> <span class="st">"sub"</span>, sub_i <span class="op">=</span> <span class="va">sub_sd</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_ranef.html">add_ranef</a></span><span class="op">(</span>.by <span class="op">=</span> <span class="st">"stim"</span>, stim_i <span class="op">=</span> <span class="va">stim_sd</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_ranef.html">add_ranef</a></span><span class="op">(</span>err <span class="op">=</span> <span class="va">error_sd</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>rt <span class="op">=</span> <span class="va">grand_i</span> <span class="op">+</span> <span class="va">sub_i</span> <span class="op">+</span> <span class="va">stim_i</span> <span class="op">+</span> <span class="va">err</span> <span class="op">+</span></span>
<span>         <span class="op">(</span><span class="va">cond</span> <span class="op">*</span> <span class="va">cond_eff</span><span class="op">)</span> <span class="op">+</span> </span>
<span>         <span class="op">(</span><span class="va">vers</span> <span class="op">*</span> <span class="va">vers_eff</span><span class="op">)</span> <span class="op">+</span> </span>
<span>         <span class="op">(</span><span class="va">cond</span> <span class="op">*</span> <span class="va">vers</span> <span class="op">*</span> <span class="va">cond_vers_ixn</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb314"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">dat</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">condition</span>, <span class="va">rt</span>, color <span class="op">=</span> <span class="va">version</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="va">grand_i</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_violin.html">geom_violin</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_summary.html">stat_summary</a></span><span class="op">(</span>fun <span class="op">=</span> <span class="va">mean</span>,</span>
<span>               fun.min <span class="op">=</span> \<span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">}</span>,</span>
<span>               fun.max <span class="op">=</span> \<span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">}</span>,</span>
<span>               position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html">position_dodge</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_color_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Dark2"</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:plot-ixn"></span>
<img src="11-LMEM_files/figure-html/plot-ixn-1.png" alt="Double-check the interaction between condition and version" width="100%"><p class="caption">
Figure 6.2: Double-check the interaction between condition and version
</p>
</div>
<div class="sourceCode" id="cb315"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">dat</span>, <span class="va">condition</span>, <span class="va">version</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>m <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">rt</span><span class="op">)</span> <span class="op">-</span> <span class="va">grand_i</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>            .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">version</span>, </span>
<span>              values_from <span class="op">=</span> <span class="va">m</span><span class="op">)</span></span></code></pre></div>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="left">condition</th>
<th align="right">congruent</th>
<th align="right">incongruent</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">easy</td>
<td align="right">-44.9159431</td>
<td align="right">54.29852</td>
</tr>
<tr class="even">
<td align="left">hard</td>
<td align="right">-0.1433863</td>
<td align="right">49.92514</td>
</tr>
</tbody>
</table></div>
</div>
</div>
</div>
<div id="analysis" class="section level2" number="6.4">
<h2>
<span class="header-section-number">6.4</span> Analysis<a class="anchor" aria-label="anchor" href="#analysis"><i class="fas fa-link"></i></a>
</h2>
<p>New we will run a linear mixed effects model with <code>lmer</code> and look at the summary.</p>
<div class="sourceCode" id="cb316"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lmerTest/man/lmer.html">lmer</a></span><span class="op">(</span><span class="va">rt</span> <span class="op">~</span> <span class="va">cond</span> <span class="op">*</span> <span class="va">vers</span> <span class="op">+</span></span>
<span>              <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">sub</span><span class="op">)</span> <span class="op">+</span> </span>
<span>              <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">stim</span><span class="op">)</span>,</span>
<span>            data <span class="op">=</span> <span class="va">dat</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mod.sum</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mod.sum</span></span></code></pre></div>
<pre><code>## Linear mixed model fit by REML. t-tests use Satterthwaite's method [
## lmerModLmerTest]
## Formula: rt ~ cond * vers + (1 | sub) + (1 | stim)
##    Data: dat
## 
## REML criterion at convergence: 187610.7
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -4.3483 -0.6731 -0.0041  0.6775  3.7260 
## 
## Random effects:
##  Groups   Name        Variance Std.Dev.
##  sub      (Intercept) 9241.6   96.13   
##  stim     (Intercept) 1853.4   43.05   
##  Residual              634.9   25.20   
## Number of obs: 20000, groups:  sub, 200; stim, 50
## 
## Fixed effects:
##               Estimate Std. Error         df t value Pr(&gt;|t|)    
## (Intercept)   414.7911     9.1274   178.4641  45.445   &lt;2e-16 ***
## cond           20.1996    13.6000   198.0004   1.485    0.139    
## vers           74.6415     0.3563 19749.0000 209.473   &lt;2e-16 ***
## cond:vers     -49.1459     0.7127 19749.0000 -68.961   &lt;2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Correlation of Fixed Effects:
##           (Intr) cond  vers 
## cond      0.000             
## vers      0.000  0.000      
## cond:vers 0.000  0.000 0.000</code></pre>
<div id="sense-checks" class="section level3" number="6.4.1">
<h3>
<span class="header-section-number">6.4.1</span> Sense checks<a class="anchor" aria-label="anchor" href="#sense-checks"><i class="fas fa-link"></i></a>
</h3>
<p>First, check that your groups make sense.</p>
<ul>
<li>The number of obs should be the total number of trials analysed.</li>
<li>
<code>sub</code> should be what we set <code>sub_n</code> to above.</li>
<li>
<code>stim</code> should be what we set <code>stim_n</code> to above.</li>
</ul>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="left">Random.Fator</th>
<th align="right">value</th>
<th align="right">parameters</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">sub</td>
<td align="right">200</td>
<td align="right">200</td>
</tr>
<tr class="even">
<td align="left">stim</td>
<td align="right">50</td>
<td align="right">50</td>
</tr>
</tbody>
</table></div>
</div>
<p>Next, look at the random effects.</p>
<ul>
<li>The SD for <code>sub</code> should be near <code>sub_sd</code>.</li>
<li>The SD for <code>stim</code> should be near <code>stim_sd</code>.</li>
<li>The residual SD should be near <code>error_sd</code>.</li>
</ul>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="left">Groups</th>
<th align="left">Name</th>
<th align="right">SD</th>
<th align="right">parameters</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">sub</td>
<td align="left">(Intercept)</td>
<td align="right">96</td>
<td align="right">100</td>
</tr>
<tr class="even">
<td align="left">stim</td>
<td align="left">(Intercept)</td>
<td align="right">43</td>
<td align="right">50</td>
</tr>
<tr class="odd">
<td align="left">Residual</td>
<td align="left">NA</td>
<td align="right">25</td>
<td align="right">25</td>
</tr>
</tbody>
</table></div>
</div>
<p>Finally, look at the fixed effects.</p>
<ul>
<li>The estimate for the Intercept should be near the <code>grand_i</code>.</li>
<li>The main effect of <code>cond</code> should be near what we calculated for <code>cond_eff</code>.</li>
<li>The main effect of <code>vers</code> should be near what we calculated for <code>vers_eff</code>.</li>
<li>The interaction between <code>cond</code>:<code>vers</code> should be near what we calculated for <code>cond_vers_ixn</code>.</li>
</ul>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="left">Effect</th>
<th align="right">Estimate</th>
<th align="right">parameters</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">415</td>
<td align="right">400</td>
</tr>
<tr class="even">
<td align="left">cond</td>
<td align="right">20</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">vers</td>
<td align="right">75</td>
<td align="right">75</td>
</tr>
<tr class="even">
<td align="left">cond:vers</td>
<td align="right">-49</td>
<td align="right">-50</td>
</tr>
</tbody>
</table></div>
</div>
</div>
<div id="random-effects-1" class="section level3" number="6.4.2">
<h3>
<span class="header-section-number">6.4.2</span> Random effects<a class="anchor" aria-label="anchor" href="#random-effects-1"><i class="fas fa-link"></i></a>
</h3>
<p>Plot the subject intercepts from our code above (<code>dat$sub_i</code>) against the subject intercepts calculated by <code>lmer</code> (<code>ranef(mod)$sub_id</code>).</p>
<div class="sourceCode" id="cb318"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get simulated random intercept for each subject</span></span>
<span><span class="va">sub_sim</span> <span class="op">&lt;-</span> <span class="va">dat</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">sub</span>, <span class="va">sub_i</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>.groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># join to calculated random intercept from model</span></span>
<span><span class="va">sub_sim_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/nlme/man/random.effects.html">ranef</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span><span class="op">$</span><span class="va">sub</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span>rownames <span class="op">=</span> <span class="st">"sub"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>mod_sub_i <span class="op">=</span> <span class="va">`(Intercept)`</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">sub_sim</span>, by <span class="op">=</span> <span class="st">"sub"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot to check correspondence</span></span>
<span><span class="va">sub_sim_mod</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">sub_i</span>,<span class="va">mod_sub_i</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, formula <span class="op">=</span> <span class="va">y</span><span class="op">~</span><span class="va">x</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Simulated random intercepts (sub_i)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Modeled random intercepts"</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:plot-sub-ranef"></span>
<img src="11-LMEM_files/figure-html/plot-sub-ranef-1.png" alt="Compare simulated subject random intercepts to those from the model" width="100%"><p class="caption">
Figure 6.3: Compare simulated subject random intercepts to those from the model
</p>
</div>
<p>Plot the stimulus intercepts from our code above (<code>dat$stim_i</code>) against the stimulus intercepts calculated by <code>lmer</code> (<code>ranef(mod)$stim_id</code>).</p>
<div class="sourceCode" id="cb319"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get simulated random intercept for each stimulus</span></span>
<span><span class="va">stim_sim</span> <span class="op">&lt;-</span> <span class="va">dat</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">stim</span>, <span class="va">stim_i</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>.groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># join to calculated random intercept from model</span></span>
<span><span class="va">stim_sim_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/nlme/man/random.effects.html">ranef</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span><span class="op">$</span><span class="va">stim</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span>rownames <span class="op">=</span> <span class="st">"stim"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>mod_stim_i <span class="op">=</span> <span class="va">`(Intercept)`</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">stim_sim</span>, by <span class="op">=</span> <span class="st">"stim"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot to check correspondence</span></span>
<span><span class="va">stim_sim_mod</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">stim_i</span>,<span class="va">mod_stim_i</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, formula <span class="op">=</span> <span class="va">y</span><span class="op">~</span><span class="va">x</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Simulated random intercepts (stim_i)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Modeled random intercepts"</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:plot-stim-ranef"></span>
<img src="11-LMEM_files/figure-html/plot-stim-ranef-1.png" alt="Compare simulated stimulus random intercepts to those from the model" width="100%"><p class="caption">
Figure 6.4: Compare simulated stimulus random intercepts to those from the model
</p>
</div>
</div>
<div id="function" class="section level3" number="6.4.3">
<h3>
<span class="header-section-number">6.4.3</span> Function<a class="anchor" aria-label="anchor" href="#function"><i class="fas fa-link"></i></a>
</h3>
<p>You can put the code above in a function so you can run it more easily and change the parameters. I removed the plot and set the argument defaults to the same as the example above with all fixed effects set to 0, but you can set them to other patterns.</p>
<div class="sourceCode" id="cb320"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim_lmer</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span> <span class="va">sub_n</span> <span class="op">=</span> <span class="fl">200</span>,</span>
<span>                      <span class="va">stim_n</span> <span class="op">=</span> <span class="fl">50</span>,</span>
<span>                      <span class="va">sub_sd</span> <span class="op">=</span> <span class="fl">100</span>,</span>
<span>                      <span class="va">stim_sd</span> <span class="op">=</span> <span class="fl">50</span>,</span>
<span>                      <span class="va">error_sd</span> <span class="op">=</span> <span class="fl">25</span>,</span>
<span>                      <span class="va">grand_i</span> <span class="op">=</span> <span class="fl">400</span>,</span>
<span>                      <span class="va">cond_eff</span> <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                      <span class="va">vers_eff</span> <span class="op">=</span> <span class="fl">0</span>, </span>
<span>                      <span class="va">cond_vers_ixn</span> <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_random.html">add_random</a></span><span class="op">(</span>sub <span class="op">=</span> <span class="va">sub_n</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_random.html">add_random</a></span><span class="op">(</span>stim <span class="op">=</span> <span class="va">stim_n</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_between.html">add_between</a></span><span class="op">(</span>.by <span class="op">=</span> <span class="st">"sub"</span>, condition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"easy"</span>,<span class="st">"hard"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_within.html">add_within</a></span><span class="op">(</span>version <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"congruent"</span>, <span class="st">"incongruent"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_contrast.html">add_contrast</a></span><span class="op">(</span><span class="st">"condition"</span>, colnames <span class="op">=</span> <span class="st">"cond"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_contrast.html">add_contrast</a></span><span class="op">(</span><span class="st">"version"</span>, colnames <span class="op">=</span> <span class="st">"vers"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_ranef.html">add_ranef</a></span><span class="op">(</span>.by <span class="op">=</span> <span class="st">"sub"</span>, sub_i <span class="op">=</span> <span class="va">sub_sd</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_ranef.html">add_ranef</a></span><span class="op">(</span>.by <span class="op">=</span> <span class="st">"stim"</span>, stim_i <span class="op">=</span> <span class="va">stim_sd</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_ranef.html">add_ranef</a></span><span class="op">(</span>err <span class="op">=</span> <span class="va">error_sd</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>rt <span class="op">=</span> <span class="va">grand_i</span> <span class="op">+</span> <span class="va">sub_i</span> <span class="op">+</span> <span class="va">stim_i</span> <span class="op">+</span> <span class="va">err</span> <span class="op">+</span></span>
<span>           <span class="op">(</span><span class="va">cond</span> <span class="op">*</span> <span class="va">cond_eff</span><span class="op">)</span> <span class="op">+</span> </span>
<span>           <span class="op">(</span><span class="va">vers</span> <span class="op">*</span> <span class="va">vers_eff</span><span class="op">)</span> <span class="op">+</span> </span>
<span>           <span class="op">(</span><span class="va">cond</span> <span class="op">*</span> <span class="va">vers</span> <span class="op">*</span> <span class="va">cond_vers_ixn</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lmerTest/man/lmer.html">lmer</a></span><span class="op">(</span><span class="va">rt</span> <span class="op">~</span> <span class="va">cond</span> <span class="op">*</span> <span class="va">vers</span> <span class="op">+</span></span>
<span>                <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">sub</span><span class="op">)</span> <span class="op">+</span> </span>
<span>                <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">stim</span><span class="op">)</span>,</span>
<span>              data <span class="op">=</span> <span class="va">dat</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Run the function with the default values (so all fixed effects set to 0).</p>
<div class="sourceCode" id="cb321"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">sim_lmer</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>## Linear mixed model fit by REML. t-tests use Satterthwaite's method [
## lmerModLmerTest]
## Formula: rt ~ cond * vers + (1 | sub) + (1 | stim)
##    Data: dat
## 
## REML criterion at convergence: 187256.4
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -3.9475 -0.6708 -0.0104  0.6699  3.9106 
## 
## Random effects:
##  Groups   Name        Variance Std.Dev.
##  sub      (Intercept) 9875.6   99.38   
##  stim     (Intercept) 2502.3   50.02   
##  Residual              622.7   24.95   
## Number of obs: 20000, groups:  sub, 200; stim, 50
## 
## Fixed effects:
##               Estimate Std. Error         df t value Pr(&gt;|t|)    
## (Intercept)   410.3962     9.9727   155.7853  41.152   &lt;2e-16 ***
## cond           -9.3106    14.0583   197.9885  -0.662    0.509    
## vers            0.1819     0.3529 19748.9993   0.515    0.606    
## cond:vers       0.4568     0.7058 19748.9993   0.647    0.517    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Correlation of Fixed Effects:
##           (Intr) cond  vers 
## cond      0.000             
## vers      0.000  0.000      
## cond:vers 0.000  0.000 0.000</code></pre>
<p>Try changing some variables to simulate different patterns of fixed effects.</p>
<div class="sourceCode" id="cb323"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">sim_lmer</span><span class="op">(</span>cond_eff <span class="op">=</span> <span class="fl">0</span>,</span>
<span>         vers_eff <span class="op">=</span> <span class="fl">75</span>, </span>
<span>         cond_vers_ixn <span class="op">=</span> <span class="op">-</span><span class="fl">50</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>## Linear mixed model fit by REML. t-tests use Satterthwaite's method [
## lmerModLmerTest]
## Formula: rt ~ cond * vers + (1 | sub) + (1 | stim)
##    Data: dat
## 
## REML criterion at convergence: 187200.9
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -4.5010 -0.6820 -0.0047  0.6761  4.2693 
## 
## Random effects:
##  Groups   Name        Variance Std.Dev.
##  sub      (Intercept) 8102.6   90.01   
##  stim     (Intercept) 2193.8   46.84   
##  Residual              622.4   24.95   
## Number of obs: 20000, groups:  sub, 200; stim, 50
## 
## Fixed effects:
##               Estimate Std. Error         df t value Pr(&gt;|t|)    
## (Intercept)   409.4362     9.1881   149.5551  44.562   &lt;2e-16 ***
## cond          -14.9632    12.7349   198.0073  -1.175    0.241    
## vers           74.3821     0.3528 19749.0007 210.827   &lt;2e-16 ***
## cond:vers     -50.2158     0.7056 19749.0007 -71.165   &lt;2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Correlation of Fixed Effects:
##           (Intr) cond  vers 
## cond      0.000             
## vers      0.000  0.000      
## cond:vers 0.000  0.000 0.000</code></pre>
<div class="try">
<p>How would you modify the function above to take the input of the four cell means (<code>easy_congr</code>, <code>easy_incon</code> <code>hard_congr</code>, <code>hard_incon</code>), instead of the coefficients (<code>cond_eff</code>, <code>vers_eff</code>, <code>cond_vers_ixn</code>)?</p>
</div>
</div>
<div id="power-analysis" class="section level3" number="6.4.4">
<h3>
<span class="header-section-number">6.4.4</span> Power analysis<a class="anchor" aria-label="anchor" href="#power-analysis"><i class="fas fa-link"></i></a>
</h3>
<p>Calculating power for a LMEM can seem really tricky, but if you can simulate the data you expect, you can calculate power for anything!</p>
<p>First, wrap your simulation function inside of another function that takes the argument of a replication number, runs a simulated analysis, and returns a data table of the fixed and random effects (made with <code><a href="https://generics.r-lib.org/reference/tidy.html">broom.mixed::tidy()</a></code>). You can use purrr's <code><a href="https://purrr.tidyverse.org/reference/map_dfr.html">map_df()</a></code> function to create a data table of results from multiple replications of this function. We're only running 10 replications here in the interests of time, but you'll want to run 100 or more for a proper power calculation.</p>
<div class="sourceCode" id="cb325"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim_lmer_pwr</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">rep</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">s</span> <span class="op">&lt;-</span> <span class="fu">sim_lmer</span><span class="op">(</span>cond_eff <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                vers_eff <span class="op">=</span> <span class="fl">75</span>, </span>
<span>                cond_vers_ixn <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># put just the fixed effects into a data table</span></span>
<span>  <span class="fu">broom.mixed</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="va">s</span>, <span class="st">"fixed"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>rep <span class="op">=</span> <span class="va">rep</span><span class="op">)</span> <span class="co"># add a column for which rep</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">my_power</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map_dfr.html">map_df</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="va">sim_lmer_pwr</span><span class="op">)</span></span></code></pre></div>
<p>You can then plot the distribution of estimates across your simulations.</p>
<div class="sourceCode" id="cb326"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">my_power</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">estimate</span>, color <span class="op">=</span> <span class="va">term</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">term</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="11-LMEM_files/figure-html/unnamed-chunk-6-1.png" width="100%" style="display: block; margin: auto;"></div>
<p>You can also just calculate power as the proportion of p-values less than your alpha.</p>
<div class="sourceCode" id="cb327"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_power</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">term</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>power <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">p.value</span> <span class="op">&lt;</span> <span class="fl">0.05</span><span class="op">)</span>,</span>
<span>            .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span></span></code></pre></div>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="left">term</th>
<th align="right">power</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">cond</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">cond:vers</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">vers</td>
<td align="right">1</td>
</tr>
</tbody>
</table></div>
</div>
</div>
</div>
<div id="random-slopes" class="section level2" number="6.5">
<h2>
<span class="header-section-number">6.5</span> Random slopes<a class="anchor" aria-label="anchor" href="#random-slopes"><i class="fas fa-link"></i></a>
</h2>
<p>In the example so far we've ignored random variation among subjects or stimuli in the size of the fixed effects (i.e., <strong>random slopes</strong>).</p>
<p>First, let's reset the parameters we set above.</p>
<div class="sourceCode" id="cb328"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sub_n</span>         <span class="op">&lt;-</span> <span class="fl">200</span> <span class="co"># number of subjects in this simulation</span></span>
<span><span class="va">stim_n</span>        <span class="op">&lt;-</span> <span class="fl">50</span>  <span class="co"># number of stimuli in this simulation</span></span>
<span><span class="va">sub_sd</span>        <span class="op">&lt;-</span> <span class="fl">100</span> <span class="co"># SD for the subjects' random intercept</span></span>
<span><span class="va">stim_sd</span>       <span class="op">&lt;-</span> <span class="fl">50</span>  <span class="co"># SD for the stimuli's random intercept</span></span>
<span><span class="va">error_sd</span>      <span class="op">&lt;-</span> <span class="fl">25</span>  <span class="co"># residual (error) SD</span></span>
<span><span class="va">grand_i</span>       <span class="op">&lt;-</span> <span class="fl">400</span> <span class="co"># overall mean rt</span></span>
<span><span class="va">cond_eff</span>      <span class="op">&lt;-</span> <span class="fl">50</span>  <span class="co"># mean difference between conditions: hard - easy</span></span>
<span><span class="va">vers_eff</span>      <span class="op">&lt;-</span> <span class="fl">50</span>  <span class="co"># mean difference between versions: incongruent - congruent</span></span>
<span><span class="va">cond_vers_ixn</span> <span class="op">&lt;-</span>  <span class="fl">0</span>  <span class="co"># interaction between version and condition</span></span></code></pre></div>
<div id="slopes" class="section level3" number="6.5.1">
<h3>
<span class="header-section-number">6.5.1</span> Slopes<a class="anchor" aria-label="anchor" href="#slopes"><i class="fas fa-link"></i></a>
</h3>
<p>In addition to generating a random intercept for each subject, now we will also generate a random slope for any within-subject factors. The only within-subject factor in this design is <code>version</code>. The main effect of <code>version</code> is set to 50 above, but different subjects will show variation in the size of this effect. That's what the random slope captures. We'll set <code>sub_vers_sd</code> below to the SD of this variation and use this to calculate the random slope (<code>sub_version_slope</code>) for each subject.</p>
<p>Also, it's likely that the variation between subjects in the size of the effect of version is related in some way to between-subject variation in the intercept. So we want the random intercept and slope to be correlated. Here, we'll simulate a case where subjects who have slower (larger) reaction times across the board show a smaller effect of condition, so we set <code>sub_i_vers_cor</code> below to a negative number (-0.2).</p>
<p>We just have to edit the first <code><a href="https://rdrr.io/pkg/faux/man/add_ranef.html">add_ranef()</a></code> to add two variables (<code>sub_i</code>, <code>sub_vers_slope</code>) that are correlated with r = -0.2, means of 0, and SDs equal to what we set <code>sub_sd</code> above and <code>sub_vers_sd</code> below.</p>
<div class="sourceCode" id="cb329"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sub_vers_sd</span> <span class="op">&lt;-</span> <span class="fl">20</span></span>
<span><span class="va">sub_i_vers_cor</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">0.2</span></span>
<span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_random.html">add_random</a></span><span class="op">(</span>sub <span class="op">=</span> <span class="va">sub_n</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_random.html">add_random</a></span><span class="op">(</span>stim <span class="op">=</span> <span class="va">stim_n</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_between.html">add_between</a></span><span class="op">(</span>.by <span class="op">=</span> <span class="st">"sub"</span>, condition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"easy"</span>,<span class="st">"hard"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_within.html">add_within</a></span><span class="op">(</span>version <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"congruent"</span>, <span class="st">"incongruent"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_contrast.html">add_contrast</a></span><span class="op">(</span><span class="st">"condition"</span>, colnames <span class="op">=</span> <span class="st">"cond"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_contrast.html">add_contrast</a></span><span class="op">(</span><span class="st">"version"</span>, colnames <span class="op">=</span> <span class="st">"vers"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_ranef.html">add_ranef</a></span><span class="op">(</span>.by <span class="op">=</span> <span class="st">"sub"</span>, sub_i <span class="op">=</span> <span class="va">sub_sd</span>, </span>
<span>              sub_vers_slope <span class="op">=</span> <span class="va">sub_vers_sd</span>,</span>
<span>              .cors <span class="op">=</span> <span class="va">sub_i_vers_cor</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="correlated-slopes" class="section level3" number="6.5.2">
<h3>
<span class="header-section-number">6.5.2</span> Correlated Slopes<a class="anchor" aria-label="anchor" href="#correlated-slopes"><i class="fas fa-link"></i></a>
</h3>
<p>In addition to generating a random intercept for each stimulus, we will also generate a random slope for any within-stimulus factors. Both <code>version</code> and <code>condition</code> are within-stimulus factors (i.e., all stimuli are seen in both <code>congruent</code> and <code>incongruent</code> versions and both <code>easy</code> and <code>hard</code> conditions). So the main effects of version and condition (and their interaction) will vary depending on the stimulus.</p>
<p>They will also be correlated, but in a more complex way than above. You need to set the correlations for all pairs of slopes and intercept. Let's set the correlation between the random intercept and each of the slopes to -0.4 and the slopes all correlate with each other +0.2 (You could set each of the six correlations separately if you want, though).</p>
<div class="sourceCode" id="cb330"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stim_vers_sd</span> <span class="op">&lt;-</span> <span class="fl">10</span> <span class="co"># SD for the stimuli's random slope for stim_version</span></span>
<span><span class="va">stim_cond_sd</span> <span class="op">&lt;-</span> <span class="fl">30</span> <span class="co"># SD for the stimuli's random slope for sub_cond</span></span>
<span><span class="va">stim_cond_vers_sd</span> <span class="op">&lt;-</span> <span class="fl">15</span> <span class="co"># SD for the stimuli's random slope for sub_cond:stim_version</span></span>
<span><span class="va">stim_i_cor</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">0.4</span> <span class="co"># correlations between intercept and slopes</span></span>
<span><span class="va">stim_s_cor</span> <span class="op">&lt;-</span> <span class="op">+</span><span class="fl">0.2</span> <span class="co"># correlations among slopes</span></span>
<span></span>
<span><span class="co"># specify correlations for rnorm_multi (one of several methods)</span></span>
<span><span class="va">stim_cors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">stim_i_cor</span>, <span class="va">stim_i_cor</span>, <span class="va">stim_i_cor</span>,</span>
<span>                           <span class="va">stim_s_cor</span>, <span class="va">stim_s_cor</span>,</span>
<span>                                       <span class="va">stim_s_cor</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_random.html">add_random</a></span><span class="op">(</span>sub <span class="op">=</span> <span class="va">sub_n</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_random.html">add_random</a></span><span class="op">(</span>stim <span class="op">=</span> <span class="va">stim_n</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_between.html">add_between</a></span><span class="op">(</span>.by <span class="op">=</span> <span class="st">"sub"</span>, condition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"easy"</span>,<span class="st">"hard"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_within.html">add_within</a></span><span class="op">(</span>version <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"congruent"</span>, <span class="st">"incongruent"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_contrast.html">add_contrast</a></span><span class="op">(</span><span class="st">"condition"</span>, colnames <span class="op">=</span> <span class="st">"cond"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_contrast.html">add_contrast</a></span><span class="op">(</span><span class="st">"version"</span>, colnames <span class="op">=</span> <span class="st">"vers"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_ranef.html">add_ranef</a></span><span class="op">(</span>.by <span class="op">=</span> <span class="st">"sub"</span>, sub_i <span class="op">=</span> <span class="va">sub_sd</span>, </span>
<span>              sub_vers_slope <span class="op">=</span> <span class="va">sub_vers_sd</span>,</span>
<span>              .cors <span class="op">=</span> <span class="va">sub_i_vers_cor</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_ranef.html">add_ranef</a></span><span class="op">(</span>.by <span class="op">=</span> <span class="st">"stim"</span>, stim_i <span class="op">=</span> <span class="va">stim_sd</span>,</span>
<span>              stim_vers_slope <span class="op">=</span> <span class="va">stim_vers_sd</span>,</span>
<span>              stim_cond_slope <span class="op">=</span> <span class="va">stim_cond_sd</span>,</span>
<span>              stim_cond_vers_slope <span class="op">=</span> <span class="va">stim_cond_vers_sd</span>,</span>
<span>              .cors <span class="op">=</span> <span class="va">stim_cors</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="calculate-the-dv-1" class="section level3" number="6.5.3">
<h3>
<span class="header-section-number">6.5.3</span> Calculate the DV<a class="anchor" aria-label="anchor" href="#calculate-the-dv-1"><i class="fas fa-link"></i></a>
</h3>
<p>Now we can calculate the rt by adding together an overall intercept (mean RT for all trials), the subject-specific intercept, the stimulus-specific intercept, the effect of subject condition, the stimulus-specific slope for condition, the effect of stimulus version, the stimulus-specific slope for version, the subject-specific slope for condition, the interaction between condition and version (set to 0 for this example), the stimulus-specific slope for the interaction between condition and version, and an error term.</p>
<div class="sourceCode" id="cb331"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_random.html">add_random</a></span><span class="op">(</span>sub <span class="op">=</span> <span class="va">sub_n</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_random.html">add_random</a></span><span class="op">(</span>stim <span class="op">=</span> <span class="va">stim_n</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_between.html">add_between</a></span><span class="op">(</span>.by <span class="op">=</span> <span class="st">"sub"</span>, condition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"easy"</span>,<span class="st">"hard"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_within.html">add_within</a></span><span class="op">(</span>version <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"congruent"</span>, <span class="st">"incongruent"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_contrast.html">add_contrast</a></span><span class="op">(</span><span class="st">"condition"</span>, colnames <span class="op">=</span> <span class="st">"cond"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_contrast.html">add_contrast</a></span><span class="op">(</span><span class="st">"version"</span>, colnames <span class="op">=</span> <span class="st">"vers"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_ranef.html">add_ranef</a></span><span class="op">(</span>.by <span class="op">=</span> <span class="st">"sub"</span>, sub_i <span class="op">=</span> <span class="va">sub_sd</span>, </span>
<span>              sub_vers_slope <span class="op">=</span> <span class="va">sub_vers_sd</span>,</span>
<span>              .cors <span class="op">=</span> <span class="va">sub_i_vers_cor</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_ranef.html">add_ranef</a></span><span class="op">(</span>.by <span class="op">=</span> <span class="st">"stim"</span>, stim_i <span class="op">=</span> <span class="va">stim_sd</span>,</span>
<span>              stim_vers_slope <span class="op">=</span> <span class="va">stim_vers_sd</span>,</span>
<span>              stim_cond_slope <span class="op">=</span> <span class="va">stim_cond_sd</span>,</span>
<span>              stim_cond_vers_slope <span class="op">=</span> <span class="va">stim_cond_vers_sd</span>,</span>
<span>              .cors <span class="op">=</span> <span class="va">stim_cors</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_ranef.html">add_ranef</a></span><span class="op">(</span>err <span class="op">=</span> <span class="va">error_sd</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    trial_cond_eff <span class="op">=</span> <span class="va">cond_eff</span> <span class="op">+</span> <span class="va">stim_cond_slope</span>,</span>
<span>    trial_vers_eff <span class="op">=</span> <span class="va">vers_eff</span> <span class="op">+</span> <span class="va">sub_vers_slope</span> <span class="op">+</span> <span class="va">stim_vers_slope</span>,</span>
<span>    trial_cond_vers_ixn <span class="op">=</span> <span class="va">cond_vers_ixn</span> <span class="op">+</span> <span class="va">stim_cond_vers_slope</span>,</span>
<span>    rt <span class="op">=</span> <span class="va">grand_i</span> <span class="op">+</span> <span class="va">sub_i</span> <span class="op">+</span> <span class="va">stim_i</span> <span class="op">+</span> <span class="va">err</span> <span class="op">+</span></span>
<span>         <span class="op">(</span><span class="va">cond</span> <span class="op">*</span> <span class="va">trial_cond_eff</span><span class="op">)</span> <span class="op">+</span> </span>
<span>         <span class="op">(</span><span class="va">vers</span> <span class="op">*</span> <span class="va">trial_vers_eff</span><span class="op">)</span> <span class="op">+</span> </span>
<span>         <span class="op">(</span><span class="va">cond</span> <span class="op">*</span> <span class="va">vers</span> <span class="op">*</span> <span class="va">trial_cond_vers_ixn</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>As always, graph to make sure you've simulated the general pattern you expected.</p>
<div class="sourceCode" id="cb332"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">dat</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">condition</span>, <span class="va">rt</span>, color <span class="op">=</span> <span class="va">version</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="va">grand_i</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_violin.html">geom_violin</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_summary.html">stat_summary</a></span><span class="op">(</span>fun <span class="op">=</span> <span class="va">mean</span>,</span>
<span>               fun.min <span class="op">=</span> \<span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">}</span>,</span>
<span>               fun.max <span class="op">=</span> \<span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">}</span>,</span>
<span>               position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html">position_dodge</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_color_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Dark2"</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:rslope-plot-rt"></span>
<img src="11-LMEM_files/figure-html/rslope-plot-rt-1.png" alt="Double-check the simulated pattern" width="100%"><p class="caption">
Figure 6.5: Double-check the simulated pattern
</p>
</div>
</div>
</div>
<div id="analysis-1" class="section level2" number="6.6">
<h2>
<span class="header-section-number">6.6</span> Analysis<a class="anchor" aria-label="anchor" href="#analysis-1"><i class="fas fa-link"></i></a>
</h2>
<p>New we'll run a linear mixed effects model with <code>lmer</code> and look at the summary. You specify random slopes by adding the within-level effects to the random intercept specifications. Since the only within-subject factor is version, the random effects specification for subjects is <code>(1 + vers | sub)</code>. Since both condition and version are within-stimuli factors, the random effects specification for stimuli is <code>(1 + vers*cond | stim)</code>.</p>
<p>This model will take a lot longer to run than one without random slopes specified. This might be a good time for a coffee break.</p>
<div class="sourceCode" id="cb333"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lmerTest/man/lmer.html">lmer</a></span><span class="op">(</span><span class="va">rt</span> <span class="op">~</span> <span class="va">cond</span> <span class="op">*</span> <span class="va">vers</span> <span class="op">+</span></span>
<span>              <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">vers</span> <span class="op">|</span> <span class="va">sub</span><span class="op">)</span> <span class="op">+</span> </span>
<span>              <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">vers</span><span class="op">*</span><span class="va">cond</span> <span class="op">|</span> <span class="va">stim</span><span class="op">)</span>,</span>
<span>            data <span class="op">=</span> <span class="va">dat</span><span class="op">)</span></span></code></pre></div>
<pre><code>## Warning in checkConv(attr(opt, "derivs"), opt$par, ctrl = control$checkConv, :
## Model failed to converge with max|grad| = 0.00447469 (tol = 0.002, component 1)</code></pre>
<div class="sourceCode" id="cb335"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod.sum</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mod.sum</span></span></code></pre></div>
<pre><code>## Linear mixed model fit by REML. t-tests use Satterthwaite's method [
## lmerModLmerTest]
## Formula: rt ~ cond * vers + (1 + vers | sub) + (1 + vers * cond | stim)
##    Data: dat
## 
## REML criterion at convergence: 188430.8
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -4.2679 -0.6682 -0.0014  0.6653  3.8739 
## 
## Random effects:
##  Groups   Name        Variance Std.Dev. Corr             
##  sub      (Intercept) 11392.14 106.734                   
##           vers          529.34  23.007  -0.31            
##  stim     (Intercept)  2492.91  49.929                   
##           vers           83.39   9.132  -0.17            
##           cond          813.15  28.516  -0.37  0.11      
##           vers:cond     265.71  16.301  -0.18  0.14  0.15
##  Residual               625.02  25.000                   
## Number of obs: 20000, groups:  sub, 200; stim, 50
## 
## Fixed effects:
##             Estimate Std. Error      df t value Pr(&gt;|t|)    
## (Intercept)  399.489     10.337 169.796  38.647  &lt; 2e-16 ***
## cond          54.250     15.628 222.709   3.471 0.000622 ***
## vers          49.444      2.107 188.776  23.466  &lt; 2e-16 ***
## cond:vers      2.096      4.050 205.196   0.517 0.605394    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Correlation of Fixed Effects:
##           (Intr) cond   vers  
## cond      -0.065              
## vers      -0.248  0.017       
## cond:vers -0.072 -0.222  0.049
## optimizer (nloptwrap) convergence code: 0 (OK)
## Model failed to converge with max|grad| = 0.00447469 (tol = 0.002, component 1)</code></pre>
<div id="sense-checks-1" class="section level3" number="6.6.1">
<h3>
<span class="header-section-number">6.6.1</span> Sense checks<a class="anchor" aria-label="anchor" href="#sense-checks-1"><i class="fas fa-link"></i></a>
</h3>
<p>First, check that your groups make sense.</p>
<ul>
<li>
<code>sub</code> = <code>sub_n</code> (200)</li>
<li>
<code>stim</code> = <code>stim_n</code> (50)</li>
</ul>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="left">Random.Fator</th>
<th align="right">value</th>
<th align="right">parameters</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">sub</td>
<td align="right">200</td>
<td align="right">200</td>
</tr>
<tr class="even">
<td align="left">stim</td>
<td align="right">50</td>
<td align="right">50</td>
</tr>
</tbody>
</table></div>
</div>
<p>Next, look at the SDs for the random effects.</p>
<ul>
<li>Group:<code>sub</code>
<ul>
<li>
<code>(Intercept)</code> ~= <code>sub_sd</code>
</li>
<li>
<code>vers</code> ~= <code>sub_vers_sd</code>
</li>
</ul>
</li>
<li>Group: <code>stim</code>
<ul>
<li>
<code>(Intercept)</code> ~= <code>stim_sd</code>
</li>
<li>
<code>vers</code> ~= <code>stim_vers_sd</code>
</li>
<li>
<code>cond</code> ~= <code>stim_cond_sd</code>
</li>
<li>
<code>vers:cond</code> ~= <code>stim_cond_vers_sd</code>
</li>
</ul>
</li>
<li>Residual ~= <code>error_sd</code>
</li>
</ul>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="left">Groups</th>
<th align="left">Name</th>
<th align="right">SD</th>
<th align="right">parameters</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">sub</td>
<td align="left">(Intercept)</td>
<td align="right">107</td>
<td align="right">100</td>
</tr>
<tr class="even">
<td align="left">sub</td>
<td align="left">vers</td>
<td align="right">23</td>
<td align="right">20</td>
</tr>
<tr class="odd">
<td align="left">stim</td>
<td align="left">(Intercept)</td>
<td align="right">50</td>
<td align="right">50</td>
</tr>
<tr class="even">
<td align="left">stim</td>
<td align="left">vers</td>
<td align="right">9</td>
<td align="right">10</td>
</tr>
<tr class="odd">
<td align="left">stim</td>
<td align="left">cond</td>
<td align="right">29</td>
<td align="right">30</td>
</tr>
<tr class="even">
<td align="left">stim</td>
<td align="left">vers:cond</td>
<td align="right">16</td>
<td align="right">15</td>
</tr>
<tr class="odd">
<td align="left">Residual</td>
<td align="left">NA</td>
<td align="right">25</td>
<td align="right">25</td>
</tr>
</tbody>
</table></div>
</div>
<p>The correlations are a bit more difficult to parse. The first column under <code>Corr</code> shows the correlation between the random slope for that row and the random intercept. So for <code>vers</code> under <code>sub</code>, the correlation should be close to <code>sub_i_vers_cor</code>. For all three random slopes under <code>stim</code>, the correlation with the random intercept should be near <code>stim_i_cor</code> and their correlations with each other should be near <code>stim_s_cor</code>.</p>
<p>Finally, look at the fixed effects.</p>
<ul>
<li>
<code>(Intercept)</code> ~= <code>grand_i</code>
</li>
<li>
<code>sub_cond.e</code> ~= <code>sub_cond_eff</code>
</li>
<li>
<code>stim_version.e</code> ~= <code>stim_vers_eff</code>
</li>
<li>
<code>sub_cond.e</code>:<code>stim_version.e</code> ~= <code>cond_vers_ixn</code>
</li>
</ul>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="left">Effect</th>
<th align="right">Estimate</th>
<th align="right">parameters</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">399</td>
<td align="right">400</td>
</tr>
<tr class="even">
<td align="left">cond</td>
<td align="right">54</td>
<td align="right">50</td>
</tr>
<tr class="odd">
<td align="left">vers</td>
<td align="right">49</td>
<td align="right">50</td>
</tr>
<tr class="even">
<td align="left">cond:vers</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
</tbody>
</table></div>
</div>
</div>
<div id="function-1" class="section level3" number="6.6.2">
<h3>
<span class="header-section-number">6.6.2</span> Function<a class="anchor" aria-label="anchor" href="#function-1"><i class="fas fa-link"></i></a>
</h3>
<p>You can put the code above in a function so you can run it more easily and change the parameters. I removed the plot and set the argument defaults to the same as the example above, but you can set them to other patterns.</p>
<div class="sourceCode" id="cb337"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim_lmer_slope</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span> <span class="va">sub_n</span> <span class="op">=</span> <span class="fl">200</span>,</span>
<span>                            <span class="va">stim_n</span> <span class="op">=</span> <span class="fl">50</span>,</span>
<span>                            <span class="va">sub_sd</span> <span class="op">=</span> <span class="fl">100</span>,</span>
<span>                            <span class="va">sub_vers_sd</span> <span class="op">=</span> <span class="fl">20</span>, </span>
<span>                            <span class="va">sub_i_vers_cor</span> <span class="op">=</span> <span class="op">-</span><span class="fl">0.2</span>,</span>
<span>                            <span class="va">stim_sd</span> <span class="op">=</span> <span class="fl">50</span>,</span>
<span>                            <span class="va">stim_vers_sd</span> <span class="op">=</span> <span class="fl">10</span>,</span>
<span>                            <span class="va">stim_cond_sd</span> <span class="op">=</span> <span class="fl">30</span>,</span>
<span>                            <span class="va">stim_cond_vers_sd</span> <span class="op">=</span> <span class="fl">15</span>,</span>
<span>                            <span class="va">stim_i_cor</span> <span class="op">=</span> <span class="op">-</span><span class="fl">0.4</span>,</span>
<span>                            <span class="va">stim_s_cor</span> <span class="op">=</span> <span class="op">+</span><span class="fl">0.2</span>,</span>
<span>                            <span class="va">error_sd</span> <span class="op">=</span> <span class="fl">25</span>,</span>
<span>                            <span class="va">grand_i</span> <span class="op">=</span> <span class="fl">400</span>,</span>
<span>                            <span class="va">sub_cond_eff</span> <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                            <span class="va">stim_vers_eff</span> <span class="op">=</span> <span class="fl">0</span>, </span>
<span>                            <span class="va">cond_vers_ixn</span> <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_random.html">add_random</a></span><span class="op">(</span>sub <span class="op">=</span> <span class="va">sub_n</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_random.html">add_random</a></span><span class="op">(</span>stim <span class="op">=</span> <span class="va">stim_n</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_between.html">add_between</a></span><span class="op">(</span>.by <span class="op">=</span> <span class="st">"sub"</span>, condition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"easy"</span>,<span class="st">"hard"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_within.html">add_within</a></span><span class="op">(</span>version <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"congruent"</span>, <span class="st">"incongruent"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_contrast.html">add_contrast</a></span><span class="op">(</span><span class="st">"condition"</span>, colnames <span class="op">=</span> <span class="st">"cond"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_contrast.html">add_contrast</a></span><span class="op">(</span><span class="st">"version"</span>, colnames <span class="op">=</span> <span class="st">"vers"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_ranef.html">add_ranef</a></span><span class="op">(</span>.by <span class="op">=</span> <span class="st">"sub"</span>, sub_i <span class="op">=</span> <span class="va">sub_sd</span>, </span>
<span>              sub_vers_slope <span class="op">=</span> <span class="va">sub_vers_sd</span>,</span>
<span>              .cors <span class="op">=</span> <span class="va">sub_i_vers_cor</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_ranef.html">add_ranef</a></span><span class="op">(</span>.by <span class="op">=</span> <span class="st">"stim"</span>, stim_i <span class="op">=</span> <span class="va">stim_sd</span>,</span>
<span>              stim_vers_slope <span class="op">=</span> <span class="va">stim_vers_sd</span>,</span>
<span>              stim_cond_slope <span class="op">=</span> <span class="va">stim_cond_sd</span>,</span>
<span>              stim_cond_vers_slope <span class="op">=</span> <span class="va">stim_cond_vers_sd</span>,</span>
<span>              .cors <span class="op">=</span> <span class="va">stim_cors</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_ranef.html">add_ranef</a></span><span class="op">(</span>err <span class="op">=</span> <span class="va">error_sd</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>      trial_cond_eff <span class="op">=</span> <span class="va">cond_eff</span> <span class="op">+</span> <span class="va">stim_cond_slope</span>,</span>
<span>      trial_vers_eff <span class="op">=</span> <span class="va">vers_eff</span> <span class="op">+</span> <span class="va">sub_vers_slope</span> <span class="op">+</span> <span class="va">stim_vers_slope</span>,</span>
<span>      trial_cond_vers_ixn <span class="op">=</span> <span class="va">cond_vers_ixn</span> <span class="op">+</span> <span class="va">stim_cond_vers_slope</span>,</span>
<span>      rt <span class="op">=</span> <span class="va">grand_i</span> <span class="op">+</span> <span class="va">sub_i</span> <span class="op">+</span> <span class="va">stim_i</span> <span class="op">+</span> <span class="va">err</span> <span class="op">+</span></span>
<span>           <span class="op">(</span><span class="va">cond</span> <span class="op">*</span> <span class="va">trial_cond_eff</span><span class="op">)</span> <span class="op">+</span> </span>
<span>           <span class="op">(</span><span class="va">vers</span> <span class="op">*</span> <span class="va">trial_vers_eff</span><span class="op">)</span> <span class="op">+</span> </span>
<span>           <span class="op">(</span><span class="va">cond</span> <span class="op">*</span> <span class="va">vers</span> <span class="op">*</span> <span class="va">trial_cond_vers_ixn</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lmerTest/man/lmer.html">lmer</a></span><span class="op">(</span><span class="va">rt</span> <span class="op">~</span> <span class="va">cond</span> <span class="op">*</span> <span class="va">vers</span> <span class="op">+</span></span>
<span>                <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">vers</span> <span class="op">|</span> <span class="va">sub</span><span class="op">)</span> <span class="op">+</span> </span>
<span>                <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">vers</span><span class="op">*</span><span class="va">cond</span> <span class="op">|</span> <span class="va">stim</span><span class="op">)</span>,</span>
<span>              data <span class="op">=</span> <span class="va">dat</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Run the function with the default values (null fixed effects).</p>
<div class="sourceCode" id="cb338"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">sim_lmer_slope</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>## Warning in checkConv(attr(opt, "derivs"), opt$par, ctrl = control$checkConv, :
## Model failed to converge with max|grad| = 0.00362154 (tol = 0.002, component 1)</code></pre>
<pre><code>## Linear mixed model fit by REML. t-tests use Satterthwaite's method [
## lmerModLmerTest]
## Formula: rt ~ cond * vers + (1 + vers | sub) + (1 + vers * cond | stim)
##    Data: dat
## 
## REML criterion at convergence: 188659.7
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -3.8663 -0.6744 -0.0026  0.6593  4.3195 
## 
## Random effects:
##  Groups   Name        Variance Std.Dev. Corr             
##  sub      (Intercept) 10000.81 100.004                   
##           vers          430.87  20.757  -0.27            
##  stim     (Intercept)  2483.13  49.831                   
##           vers           70.13   8.374  -0.33            
##           cond          827.33  28.763  -0.50  0.17      
##           vers:cond     235.48  15.345  -0.45 -0.14  0.11
##  Residual               635.55  25.210                   
## Number of obs: 20000, groups:  sub, 200; stim, 50
## 
## Fixed effects:
##             Estimate Std. Error      df t value Pr(&gt;|t|)    
## (Intercept)  409.033      9.985 157.710  40.965  &lt; 2e-16 ***
## cond          48.101     14.720 225.704   3.268  0.00125 ** 
## vers          50.578      1.919 183.278  26.351  &lt; 2e-16 ***
## cond:vers      2.743      3.720 196.109   0.737  0.46172    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Correlation of Fixed Effects:
##           (Intr) cond   vers  
## cond      -0.098              
## vers      -0.289  0.030       
## cond:vers -0.184 -0.188 -0.052
## optimizer (nloptwrap) convergence code: 0 (OK)
## Model failed to converge with max|grad| = 0.00362154 (tol = 0.002, component 1)</code></pre>
<p>Try changing some variables to simulate fixed effects.</p>
<div class="sourceCode" id="cb341"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">sim_lmer_slope</span><span class="op">(</span>sub_cond_eff <span class="op">=</span> <span class="fl">50</span>,</span>
<span>               stim_vers_eff <span class="op">=</span> <span class="fl">50</span>, </span>
<span>               cond_vers_ixn <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<pre><code>## Warning in checkConv(attr(opt, "derivs"), opt$par, ctrl = control$checkConv, :
## Model failed to converge with max|grad| = 0.00234269 (tol = 0.002, component 1)</code></pre>
<pre><code>## Linear mixed model fit by REML ['lmerModLmerTest']
## Formula: rt ~ cond * vers + (1 + vers | sub) + (1 + vers * cond | stim)
##    Data: dat
## REML criterion at convergence: 188295.8
## Random effects:
##  Groups   Name        Std.Dev. Corr             
##  sub      (Intercept) 106.748                   
##           vers         17.834  -0.33            
##  stim     (Intercept)  51.017                   
##           vers          9.761  -0.33            
##           cond         31.608  -0.40  0.08      
##           vers:cond    15.751  -0.45  0.19  0.08
##  Residual              24.974                   
## Number of obs: 20000, groups:  sub, 200; stim, 50
## Fixed Effects:
## (Intercept)         cond         vers    cond:vers  
##     401.208       19.910       49.575       -1.716  
## optimizer (nloptwrap) convergence code: 0 (OK) ; 0 optimizer warnings; 1 lme4 warnings</code></pre>
</div>
</div>
<div id="exercises" class="section level2" number="6.7">
<h2>
<span class="header-section-number">6.7</span> Exercises<a class="anchor" aria-label="anchor" href="#exercises"><i class="fas fa-link"></i></a>
</h2>
<ol style="list-style-type: decimal">
<li><p>Calculate power for the parameters in the last example using the <code>sim_lmer_slope()</code> function.</p></li>
<li><p>Simulate data for the following design:</p></li>
</ol>
<ul>
<li>100 raters rate 50 faces from group A and 50 faces from group B</li>
<li>The rt has a mean value of 50</li>
<li>Group B values are 5 points higher than group A</li>
<li>Rater intercepts have an SD of 5</li>
<li>Face intercepts have an SD of 10</li>
<li>The residual error has an SD of 8</li>
</ul>
<ol start="3" style="list-style-type: decimal">
<li><p>For the design from exercise 2, write a function that simulates data and runs a mixed effects analysis on it.</p></li>
<li><p>The package <code>faux</code> has a built-in dataset called <code>fr4</code>. Type <code><a href="https://rdrr.io/pkg/faux/man/fr4.html">?faux::fr4</a></code> into the console to view the help for this dataset. Run a mixed effects model on this dataset looking at the effect of <code>face_sex</code> on ratings. Remember to include a random slope for the effect of face sex and explicitly add a contrast code.</p></li>
<li><p>Use the parameters from this analysis to simulate a new dataset with 50 male and 50 female faces, and 100 raters.</p></li>
</ol>
</div>
</div>



<div class="chapter-nav">
<div class="prev"><a href="introduction-to-bayesian-estimation.html"><span class="header-section-number">5</span> Introduction to Bayesian Estimation</a></div>
<div class="next"><a href="installing-r.html"><span class="header-section-number">A</span> Installing R</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#introduction-to-linear-mixed-effects-models"><span class="header-section-number">6</span> Introduction to Linear Mixed Effects Models</a></li>
<li><a class="nav-link" href="#learning-objectives-5"><span class="header-section-number">6.1</span> Learning objectives</a></li>
<li><a class="nav-link" href="#packages-and-the-data-sets-2"><span class="header-section-number">6.2</span> Packages and the data sets</a></li>
<li>
<a class="nav-link" href="#simulation"><span class="header-section-number">6.3</span> Simulation</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#random-factors"><span class="header-section-number">6.3.1</span> Random Factors</a></li>
<li><a class="nav-link" href="#fixed-factors"><span class="header-section-number">6.3.2</span> Fixed Factors</a></li>
<li><a class="nav-link" href="#contrast-coding"><span class="header-section-number">6.3.3</span> Contrast Coding</a></li>
<li><a class="nav-link" href="#random-effects"><span class="header-section-number">6.3.4</span> Random Effects</a></li>
<li><a class="nav-link" href="#error-term"><span class="header-section-number">6.3.5</span> Error Term</a></li>
<li><a class="nav-link" href="#calculate-the-dv"><span class="header-section-number">6.3.6</span> Calculate the DV</a></li>
<li><a class="nav-link" href="#interactions"><span class="header-section-number">6.3.7</span> Interactions</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#analysis"><span class="header-section-number">6.4</span> Analysis</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#sense-checks"><span class="header-section-number">6.4.1</span> Sense checks</a></li>
<li><a class="nav-link" href="#random-effects-1"><span class="header-section-number">6.4.2</span> Random effects</a></li>
<li><a class="nav-link" href="#function"><span class="header-section-number">6.4.3</span> Function</a></li>
<li><a class="nav-link" href="#power-analysis"><span class="header-section-number">6.4.4</span> Power analysis</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#random-slopes"><span class="header-section-number">6.5</span> Random slopes</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#slopes"><span class="header-section-number">6.5.1</span> Slopes</a></li>
<li><a class="nav-link" href="#correlated-slopes"><span class="header-section-number">6.5.2</span> Correlated Slopes</a></li>
<li><a class="nav-link" href="#calculate-the-dv-1"><span class="header-section-number">6.5.3</span> Calculate the DV</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#analysis-1"><span class="header-section-number">6.6</span> Analysis</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#sense-checks-1"><span class="header-section-number">6.6.1</span> Sense checks</a></li>
<li><a class="nav-link" href="#function-1"><span class="header-section-number">6.6.2</span> Function</a></li>
</ul>
</li>
<li><a class="nav-link" href="#exercises"><span class="header-section-number">6.7</span> Exercises</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/psyteachr/statsresdesign/blob/master/book/11-LMEM.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/psyteachr/statsresdesign/edit/master/book/11-LMEM.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>
</div>
<script>

/* update total correct if #webex-total_correct exists */
update_total_correct = function() {
  console.log("webex: update total_correct");

  if (t = document.getElementById("webex-total_correct")) {
    var correct = document.getElementsByClassName("webex-correct").length;
    var solvemes = document.getElementsByClassName("webex-solveme").length;
    var radiogroups = document.getElementsByClassName("webex-radiogroup").length;
    var selects = document.getElementsByClassName("webex-select").length;

    t.innerHTML = correct + " of " + (solvemes + radiogroups + selects) + " correct";
  }
}

/* webex-solution button toggling function */
b_func = function() {
  console.log("webex: toggle hide");

  var cl = this.parentElement.classList;
  if (cl.contains('open')) {
    cl.remove("open");
  } else {
    cl.add("open");
  }
}

/* function for checking solveme answers */
solveme_func = function(e) {
  console.log("webex: check solveme");

  var real_answers = JSON.parse(this.dataset.answer);
  var my_answer = this.value;
  var cl = this.classList;
  if (cl.contains("ignorecase")) {
    my_answer = my_answer.toLowerCase();
  }
  if (cl.contains("nospaces")) {
    my_answer = my_answer.replace(/ /g, "")
  }

  if (my_answer == "") {
    cl.remove("webex-correct");
    cl.remove("webex-incorrect");
  } else if (real_answers.includes(my_answer)) {
    cl.add("webex-correct");
    cl.remove("webex-incorrect");
  } else {
    cl.add("webex-incorrect");
    cl.remove("webex-correct");
  }

  // match numeric answers within a specified tolerance
  if(this.dataset.tol > 0){
    var tol = JSON.parse(this.dataset.tol);
    var matches = real_answers.map(x => Math.abs(x - my_answer) < tol)
    if (matches.reduce((a, b) => a + b, 0) > 0) {
      cl.add("webex-correct");
    } else {
      cl.remove("webex-correct");
    }
  }

  // added regex bit
  if (cl.contains("regex")){
    answer_regex = RegExp(real_answers.join("|"))
    if (answer_regex.test(my_answer)) {
      cl.add("webex-correct");
    }
  }

  update_total_correct();
}

/* function for checking select answers */
select_func = function(e) {
  console.log("webex: check select");

  var cl = this.classList

  /* add style */
  cl.remove("webex-incorrect");
  cl.remove("webex-correct");
  if (this.value == "answer") {
    cl.add("webex-correct");
  } else if (this.value != "blank") {
    cl.add("webex-incorrect");
  }

  update_total_correct();
}

/* function for checking radiogroups answers */
radiogroups_func = function(e) {
  console.log("webex: check radiogroups");

  var checked_button = document.querySelector('input[name=' + this.id + ']:checked');
  var cl = checked_button.parentElement.classList;
  var labels = checked_button.parentElement.parentElement.children;

  /* get rid of styles */
  for (i = 0; i < labels.length; i++) {
    labels[i].classList.remove("webex-incorrect");
    labels[i].classList.remove("webex-correct");
  }

  /* add style */
  if (checked_button.value == "answer") {
    cl.add("webex-correct");
  } else {
    cl.add("webex-incorrect");
  }

  update_total_correct();
}

window.onload = function() {
  console.log("webex onload");
  /* set up solution buttons */
  var buttons = document.getElementsByTagName("button");

  for (var i = 0; i < buttons.length; i++) {
    if (buttons[i].parentElement.classList.contains('webex-solution')) {
      buttons[i].onclick = b_func;
    }
  }

  /* set up webex-solveme inputs */
  var solveme = document.getElementsByClassName("webex-solveme");

  for (var i = 0; i < solveme.length; i++) {
    /* make sure input boxes don't auto-anything */
    solveme[i].setAttribute("autocomplete","off");
    solveme[i].setAttribute("autocorrect", "off");
    solveme[i].setAttribute("autocapitalize", "off");
    solveme[i].setAttribute("spellcheck", "false");
    solveme[i].value = "";

    /* adjust answer for ignorecase or nospaces */
    var cl = solveme[i].classList;
    var real_answer = solveme[i].dataset.answer;
    if (cl.contains("ignorecase")) {
      real_answer = real_answer.toLowerCase();
    }
    if (cl.contains("nospaces")) {
      real_answer = real_answer.replace(/ /g, "");
    }
    solveme[i].dataset.answer = real_answer;

    /* attach checking function */
    solveme[i].onkeyup = solveme_func;
    solveme[i].onchange = solveme_func;

    $(solveme[i]).after(" <span class='webex-icon'></span>");
  }

  /* set up radiogroups */
  var radiogroups = document.getElementsByClassName("webex-radiogroup");
  for (var i = 0; i < radiogroups.length; i++) {
    radiogroups[i].onchange = radiogroups_func;
  }

  /* set up selects */
  var selects = document.getElementsByClassName("webex-select");
  for (var i = 0; i < selects.length; i++) {
    selects[i].onchange = select_func;
    $(selects[i]).after(" <span class='webex-icon'></span>");
  }

  update_total_correct();
}

</script><script>
$( document ).ready(function() {
  var cite = ' ';
  var psyteachr = ' <a href="https://psyteachr.github.io/"><img src="images/logos/psyteachr_logo.png" style="height: 31px; color: white;" alt="psyTeachR: Reproducible Research" /></a>';
  var license = ' <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/" target="blank"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png"></a>';

  $("footer div.row div:eq(1) p").html(
    psyteachr + license + cite
  );

  // open rdrr links externally
  $("a[href^='https://rdrr.io']").click(function(){
    window.open(this.href);
    return false;
  });

  // visible second sidebar in mobile
  function move_sidebar() {
    var w = window.innerWidth;
    if (w < 992) {
      $("#toc").appendTo($("#main-nav"));
    } else {
      $("#toc").appendTo($("div.sidebar-chapter"));
    }
  }
  move_sidebar();
  window.onresize = move_sidebar;
});
</script>

</div>
 <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Statistics and Research Design</strong>" was written by James Bartlett. It was last built on 2024-03-18.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
